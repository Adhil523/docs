---
title: Settings
description: How to use CRD settings
---
The Settings CRD is one of the most important CRDs in Operator v2. It enables all the necessary adjustments so that the Operator can adapt to your usage and environment.

The process is always the same: you create a YAML file, submit it to Kubernetes, and the Operator takes care of the rest.
All the values present in the `Metadata` section are not used by the Operator. Conversely, the `Spec` section is used to define the Operator's parameters.
You will always find 3 parameters there:
- **stacks**: which allows defining the stacks that should use this configuration (you can put a * to indicate that all stacks should use this configuration)
- **key**: Which allows defining the key of the configuration (you can put a * so that it applies to all services)
- **value**: which allows defining the value of the configuration

## Define PostgreSQL clusters
In this example, we will set up a configuration for a PostgreSQL cluster that will be used only by the `formance-dev` stack but will apply to all the modules of this stack.
Thus, the different modules of the Stack will use this PostgreSQL cluster while being isolated in their own database.

:::info
This database is created following the format: `{stackName}-{module}`
:::

```yaml
apiVersion: formance.com/v1beta1
kind: Settings
metadata:
  name: formance-dev-postgres-uri
spec:
  key: postgres.*.uri
  stacks:
    - 'formance-dev'
  value: postgresql://formance:formance@postgresql.formance-system.svc:5432?disableSSLMode=true
```

### Use AWS IAM Role
In this example, aws iam role is used to connect to the database. The `formance-dev` stack will use this configuration.

```yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: aws-rds-access-role
  namespace: formance-system
  labels:
    formance.com/stack: any
  annotations:
    eks.amazonaws.com/role-arn: arn:aws:iam::AWS_ACCOUNT_ID:role/AWS_ROLE_NAME
---
apiVersion: formance.com/v1beta1
kind: Settings
metadata:
  name: formance-dev-postgres-uri
spec:
  key: postgres.*.uri
  stacks:
    - 'formance-dev'
  value: postgresql://formance@postgresql.formance-system.svc:5432?awsRole=aws-rds-access-role
 ```

## Define module resource requests
In this example, we will set up a configuration for the resource requests of the `formance-dev` stack. This configuration will apply to all the modules of this stack.

```yaml
apiVersion: formance.com/v1beta1
kind: Settings
metadata:
  name: formance-dev-resource-requests
spec:
  key: deployments.*.containers.*.resource-requirements.requests
  stacks:
    - 'formance-dev'
  value: cpu=10m,memory=100Mi
```

## Define a Broker
In this example, we will set up a configuration for the Broker of the `formance-dev` stack. This configuration will apply to all the modules of this stack.

```yaml
apiVersion: formance.com/v1beta1
kind: Settings
metadata:
  name: formance-dev-broker
spec:
  key: broker.dsn
  stacks:
    - 'formance-dev'
  value: nats://nats.formance-system.svc:4222?replicas=3
```

## Define a OpenTelemetry Collector

In this example, we'll set up a configuration to send traces and metrics to an OpenTelemetry collector. This configuration will apply to all modules in this stack.

```yaml
apiVersion: formance.com/v1beta1
kind: Settings
metadata:
  name: stacks-otel-collector
spec:
  key: opentelemetry.*.dsn
  stacks:
    - "formance-dev"
  value: grpc://opentelemetry-collector.formance-system.svc:4317?insecure=true
```

<!-- ## Define a Replicas -->
<!-- In this example, we'll set up a configuration to define the number of replicas for the `formance-dev` stack. This configuration will apply to all modules in this stack. -->

<!-- ```yaml -->
<!-- apiVersion: formance.com/v1beta1 -->
<!-- kind: Settings -->
<!-- metadata: -->
<!--   name: stacks-replicas -->
<!-- spec: -->
<!--   key: replicas -->
<!--   stacks: -->
<!--     - "formance-dev" -->
<!--   value: "2" -->
<!-- ``` -->